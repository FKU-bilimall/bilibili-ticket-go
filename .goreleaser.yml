version: 2
project_name: bilibili-ticket-go

before:
  hooks:
    - go mod tidy
    - go install mvdan.cc/garble@latest

builds:
  - id: bilibili-ticket-go-obf
    main: main.go
    goos:
      - windows
      - linux
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags: -s -w -X "bilibili-ticket-go/global.GitCommit={{.ShortCommit}}" -X "bilibili-ticket-go/global.BuildTime={{.Timestamp}}" -X "bilibili-ticket-go/global.LoggerLevel=4"
    env:
      - CGO_ENABLED=0
    tool: garble
    binary: bilibili-ticket-go-obf
    command: "-tiny"
    flags: ["build", "-trimpath" ]

archives:
  - formats: zip
    name_template: "{{ .ProjectName }}_{{ .Os }}_{{ .Arch }}_obf"

checksum:
  name_template: "checksums.txt"
